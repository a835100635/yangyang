<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="index.css">
  <script src="https://unpkg.com/vue@3.2.12/dist/vue.global.js"></script>
  <title></title>
</head>
<body>
  <div id="app">
    <h1>ç¬¬ {{ level }} å…³</h1>
    <header>
      <span class="btn" @click="handleReset">é‡ç½®</span>
      <span class="btn" @click="handleSwitch('prev')">ä¸Šä¸€å…³</span>
      <span class="btn" @click="handleSwitch('next')">ä¸‹ä¸€å…³</span>
    </header>
    <!-- å®¹å™¨ -->
    <div class="container">
      <div class="card" v-for="(item, index) in cards" :key="index" :style="setCardStyle(item)">
        <span>{{ item.icon }}</span>
      </div>
    </div>
    <!-- å¡æ§½ -->
    <div class="card-slot">

    </div>
  </div>
  <script>
    const { reactive, toRefs, setup, computed } = Vue;
    const App = {
      setup() {
        const data = reactive({
          level: 1,
          cards: []
        });
        // å¡ç‰‡é»˜è®¤åç§»å€¼
        const offsetDefaultValue = [0, 20, -20, 40, -40];
        const offsetDefaultValueLength = offsetDefaultValue.length;

        // å¡ç‰‡é»˜è®¤å›¾æ ‡
        const defaultIcons = ['ğŸ‘','ğŸ˜€', 'ğŸ˜­', 'ğŸ˜‚', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜˜', 'ğŸ˜³', 'ğŸ˜‡', 'ğŸ¤ª'];
        const icons = defaultIcons.slice(0, 2 * data.level);

        // å¡ç‰‡é»˜è®¤ç”Ÿæˆ3çš„å€æ•°
        const defaultRounds = [3, 6, 9];

        // å¡ç‰‡éšæœºé€‰åŒº
        const defaultRange = computed(() => {
          return [[2, 5], [3, 7], [0, 7],[2, 9], [1, 8]][Math.min(4, data.level - 1)]
        })

        // åˆ›å»ºå¡ç‰‡å±æ€§é›†åˆ
        const createCardInfo = (icon) => {
          // åç§»
          const offset = offsetDefaultValue[Math.floor(offsetDefaultValueLength * Math.random())];
          // è¡Œ
          const row = defaultRange.value[0] + Math.floor((defaultRange.value[1] - defaultRange.value[0]) * Math.random());
          // åˆ—
          const col = defaultRange.value[0] + Math.floor((defaultRange.value[1] - defaultRange.value[0]) * Math.random());

          data.cards.push({
            icon,
            x: col * 100 + offset,
            y: row * 100 + offset
          })
        }

        console.log(icons);

        // åˆå§‹åŒ–
        const init = () => {
          for(const i in icons) {
            // éšæœº3çš„å€æ•°
            const rounds = defaultRounds[Math.floor(Math.random() * 3)];
            for(let k = 0; k < rounds; k++) {
              createCardInfo(icons[i]);
            }
          }
        }
        init();
        console.log(data.cards)

        // è®¾ç½®å¡ç‰‡æ ·å¼
        const setCardStyle = (info) => {
          const { x, y } = info;
          return `
            transform: translateX(${x}%) translateY(${y}%);
          `;
        }

        // åˆ‡æ¢å…³å¡
        const handleSwitch = (type) => {
          if(type === 'prev') {
            if(data.level === 1) {
              window.alert('å·²ç»æ˜¯ç¬¬ä¸€å…³äº†');
              return;
            }
            data.level--;
          } else {
            if(data.level === 10) {
              window.alert('å·²ç»æ˜¯æœ€åä¸€å…³äº†');
              return;
            }
            data.level++;
          }
          handleReset();
        }

        // é‡ç½®æ¸¸æˆ
        const handleReset = () => {
          // æ¸…ç©ºå·²æœ‰çš„å¡ç‰‡
          data.cards.length = 0;
          init();
        }

        const dataRefs = toRefs(data);
        return {
          ...dataRefs,
          setCardStyle,
          handleSwitch,
          handleReset
        }
      }
    }
    Vue.createApp(App).mount('#app');
  </script>
</body>
</html>